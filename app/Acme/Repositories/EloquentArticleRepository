<?php namespace Acme\Repositories;

use Acme\Repositories\TagRepositoryInterface;
use Illuminate\Database\Eloquent\Model;

class EloquentArticleRepository implements ArticleRepositoryInterface
{
	protected $article;
	protected $tag;

	public function __construct(Model $article, TagRepositoryInterface $tag)
	{
		$this->article = $article;
		$this->tag = $tag;
	}

	public function byPage($page = 1, $limit = 10)
	{
		$articles = $this->article->with('tags')
			 		->where('status_id', 1)
			 		->orderBy('created_at', 'desc')
			 		->skip( $limit * ($page-1) )
			 		->take($limit)
			 		->get();

		 // Create object to return data useful
 		// for pagination
 		$data = new \StdClass();
 		$data->items = $articles->all();
 		$data->totalItems = $this->totalArticles();

		return $data;
	}

	public function bySlug($slug)
	{
		// Include tags using Eloquent relationships
		return $this->article->with('tags')
			->where('status_id', 1)
            ->where('slug', $slug)
            ->first();
	}

	public function byTag($tag, $page = 1, $limit = 10);
}